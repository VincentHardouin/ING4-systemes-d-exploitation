#include <sys/wait.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

int main(int argc, char *argv[]) {
    int pipefd[2];
    pid_t cpid;
    char buf;

    if (pipe(pipefd) == -1) {
        perror("pipe");
        exit(EXIT_FAILURE);
    }
    cpid = fork();

    if (cpid == -1) {
        perror("fork");
        exit(EXIT_FAILURE);
    }

    // créer un processus fils 
    // Celui-ci ferme l'accès en écriture du pipe  
    // Il écoute l'entrée du pipe et écrit le résultat de ce dernier dans la sortie standard;


    if (cpid == 0) {
        close(pipefd[1]); // Close write end of the pipe
        dup2(pipefd[0], STDIN_FILENO); // Makes the standard input the read end of the pipe
        system("more"); // execute "more"
        _exit(EXIT_SUCCESS); // exit
    } else {
        close(pipefd[0]); // Close read end of the pipe
        dup2(pipefd[1], STDOUT_FILENO); // Makes the standard ouput the write end of the pipe
        system("ps aux"); // execute "ps aux"
        wait(NULL);// Waits for child process
        exit(EXIT_SUCCESS); // exit
    }
}
