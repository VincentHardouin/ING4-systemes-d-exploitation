#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/shm.h>
#include <sys/wait.h>
#define KEY 4567
#define PERMS 0660

int main(int argc, char **argv) {
    int id;
    int i;
    int *ptr;
    system("ipcs -m");
    id = shmget(KEY, sizeof(int), IPC_CREAT | PERMS); // Alloue un espace mémoire partagé et retourne l'id de cette espace
    system("ipcs -m");

    ptr = (int *) shmat(id, NULL, 0); // Créer un lien entre l'espace alloué et le processus appelant. NULL : signifie qu'il n'a pas d'adresse d'alloué et donc la méthode en choisit une. 
    *ptr = 54;
    i = 54;

    if (fork() == 0) {
        (*ptr)++;
        i++;

        printf("Value of *ptr = %d\nValue of i = %d\n", *ptr, i);
        exit(0);
    } else {
        wait(NULL);
        printf("Value of *ptr = %d\nValue of i = %d\n", *ptr, i);
        shmctl(id, IPC_RMID, NULL);
    }
}